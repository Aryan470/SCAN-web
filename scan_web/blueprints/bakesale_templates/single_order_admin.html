<html>
    <head>
        <title>SCAN Bake Sale Order (Admin View)</title>
    </head>

    <body>
        <p id="authname" style="vertical-align: top; float: right"><b>Logged in as:</b> <a href="{{url_for("info.edit_profile")}}">{{session["name"]}}</a></p>
        <h1>{{order.userInfo.name}}'s SCAN Bake Sale Order (Admin View)</h1>
        <h2>Order Info</h2>
        <p><b>Received On:</b> <span class="datetime">{{order.UTC_timestamp}}</span></p>
        <p><b>Status:</b> {{order.statusText}}</p>
        {% if order.delivery is defined %}
            <p><b>Delivery Information:</b></p>
            <ul>
                <li>Delivered by: <a href="{{url_for("info.view_profile", uid=order.delivery.deliveredBy.uid)}}">{{order.delivery.deliveredBy.name}}</a></li>
                <li>Delivered at: <span class="datetime">{{order.delivery.UTC_timestamp}}</span<</li>
            </ul>
            <br>
        {% endif %}
        {% if order.collection is defined %}
            <p><b>Collection Information:</b></p>
            <ul>
                <li>Collection by: <a href="{{url_for("info.view_profile", uid=order.collection.collector.uid)}}">{{order.collection.collector.name}}</a></li>
                <li>Collection at: <span class="datetime">{{order.collection.UTC_timestamp}}</span<</li>
            </ul>
            <br>
        {% endif %}
        {% if order.notes is defined %}
            <p><b>Notes:</b> {{order.notes}}</p>
        {% endif %}
        <a href="{{url_for("bakesale.report_issue", orderID=order.orderID, view=request.args.get("view"))}}">Report an issue</a>
        {% if order.issues is defined %}
            <h3>Issues</h3>
            <ul>
            {% for issue in order.issues %}
                <li>(<span class="datetime">{{issue.UTC_timestamp}}</span>, {% if issue.resolved %}Resolved{% else %}Unresolved{%endif%}): {{issue.description}}</li>
            {% endfor %}
            </ul>
        {% endif %}
        <p><b>Total Price:</b> ${{'%0.2f' % order.price}}</p>
        <p><b>Order ID:</b> {{order.orderID}}</p>
        {% if order.delivery is defined %}
            <a href={{url_for("bakesale.collect_item", orderID=order.orderID, price=order.price, deliverer_id=order.delivery.deliveredBy.uid, deliverer_name=order.delivery.deliveredBy.name)}}><h2>Collect this</h2></a>
        {% endif %}
        <h3>Ordered Items:</h3>
        {% for category in order.fulfillment %}
            <h5>{{product_data[category].name}}</h5>
            <ul>
            {% for item in order.fulfillment[category] %}
                <li>{{product_data[category].products[item].name}}:
                    {{order.fulfillment[category][item].count}} / {{order.quantities[category][item]}}
                    <ul>
                        {% for baker in order.fulfillment[category][item].bakers %}
                            <li>
                                <a href="{{url_for("info.view_profile", uid=baker)}}">{{order.fulfillment[category][item].bakers[baker].name}}</a>: {{order.fulfillment[category][item].bakers[baker].count}}
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
            </ul>
        {% endfor %}

        <h2>Customer Info</h2>
        <p><b>Name:</b> {{order.userInfo.name}}</p>
        <p><b>Phone Number:</b> <a href="tel:{{order.userInfo.phone}}">{{order.userInfo.phone}}</a></p>
        <p><b>Email Address:</b> {{order.userInfo.email}}</p>
        <p><b>Address:</b> {{order.userInfo.address}}</p>
        <br><br>
        <a href="{{url_for("bakesale.delivery_view")}}">Back to delivery view</a>
        <br>
        <a href="{{url_for("bakesale.index")}}">Back to home</a>
        <br>
        <a href="{{url_for("auth.logout")}}">Logout</a>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
        <script src="{{url_for("static", filename="render_times.js")}}"></script>
    </body>
</html>